@page
@model PRN232_FA25_Assignment_G7.RazorPages.Pages.Moderator.DashboardModel
@{
    ViewData["Title"] = "Moderator Dashboard";
}

<h1>@ViewData["Title"]</h1>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

@if (TempData["AuthError"] != null)
{
    <div class="alert alert-warning">@TempData["AuthError"]</div>
}

@if (Model.Data != null)
{
    <div class="row">
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card text-bg-primary h-100">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">üìù Exams Under Review</h5>
                    <p class="card-text fs-2 mb-3">@Model.Data.TotalExamsUnderReview</p>
                    <p class="card-text small">Exams with double-grading discrepancies</p>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card text-bg-warning h-100">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">üìã Pending Complaints</h5>
                    <p class="card-text fs-2 mb-3">@Model.Data.TotalPendingComplaints</p>
                    <p class="card-text small">Student/examiner complaints to review</p>
                    <a asp-page="/Moderator/Complaints/Index" class="btn btn-sm btn-outline-light mt-auto">Review Complaints</a>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card text-bg-danger h-100">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">‚ö†Ô∏è Zero-Score Reviews</h5>
                    <p class="card-text fs-2 mb-3">@Model.Data.TotalZeroScoreSubmissionsPending</p>
                    <p class="card-text small">Zero-score submissions pending verification</p>
                    <a asp-page="/Moderator/Verification/Index" class="btn btn-sm btn-outline-light mt-auto">Review Zero-Scores</a>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card text-bg-info h-100">
                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">üìä Top Issues</h5>
                    <p class="card-text fs-2 mb-3">@Model.Data.TopIssues.Count</p>
                    <p class="card-text small">Active issue categories</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Recent Discrepancies</h5>
                </div>
                <div class="card-body">
                    @if (Model.Data.RecentDiscrepancies.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Exam</th>
                                        <th>Examiner Score</th>
                                        <th>Other Score</th>
                                        <th>Difference</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var discrepancy in Model.Data.RecentDiscrepancies)
                                    {
                                        <tr>
                                            <td>@discrepancy.ExamName</td>
                                            <td>@discrepancy.ExaminerScore</td>
                                            <td>@discrepancy.OtherScore</td>
                                            <td><span class="badge bg-danger">@discrepancy.Difference</span></td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <p class="text-muted mb-0">No recent discrepancies found.</p>
                    }
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Top Issues</h5>
                </div>
                <div class="card-body">
                    @if (Model.Data.TopIssues.Any())
                    {
                        <ul class="list-group list-group-flush">
                            @foreach (var issue in Model.Data.TopIssues)
                            {
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    @issue.Type
                                    <span class="badge bg-primary rounded-pill">@issue.Count</span>
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <p class="text-muted mb-0">No active issues.</p>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                        <a asp-page="/Moderator/Complaints/Index" class="btn btn-primary">
                            <i class="fas fa-comments me-2"></i>Manage Complaints
                        </a>
                        <a asp-page="/Moderator/Verification/Index" class="btn btn-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>Verify Zero-Scores
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="alert alert-info">Loading dashboard data...</div>
}
